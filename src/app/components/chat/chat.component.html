<div class="chat-container">
  <div class="message-wrapper" #messageContainer>
    <app-message
      *ngFor="let message of messages"
      [message]="message.content"
      [sender]="message.sender"
      [isStreaming]="message.isStreaming ?? false"
      [isThinking]="message.isThinking ?? false"
      [isAborted]="message.isAborted ?? false">
      <!-- Add edit button for user messages -->
      <div *ngIf="message.sender === 'User'" class="message-actions">
        <button class="edit-button" (click)="copyToInput(message.content)" [disabled]="isThinking || isStreaming">
          Edit
        </button>
      </div>
    </app-message>
    <!-- Only if there is no message -->
    <div *ngIf="messages.length === 0" class="empty-chat">
      <div class="empty-icon">ðŸ’¬</div>
      <h3>Start a conversation</h3>
      <p>Ask a question to begin chatting with DialogAI</p>
    </div>
  </div>
  <div class="input-area">
    <!-- Custom styled image upload button -->
    <label
      for="fileInput"
      class="image-upload-label"
      [ngClass]="{
        'image-upload-success': uploadedImgUrl,
        'image-upload-loading': isImgUploading && !uploadedImgUrl,
      }"
      title="Upload image">
      <span class="image-upload-icon">ðŸ“·</span>
    </label>
    <input
      #fileInput
      id="fileInput"
      type="file"
      accept="image/*"
      (change)="onImageSelected($event)"
      style="display: none" />

    <input
      #inputField
      type="text"
      [(ngModel)]="userInput"
      (keydown.enter)="!isThinking && !isStreaming && sendMessage()"
      [placeholder]="isThinking ? 'AI is thinking...' : isStreaming ? 'AI is responding...' : 'Type your message...'"
      [disabled]="isThinking || isStreaming || isImgUploading" />

    <!-- Send button (disabled during thinking) -->
    <button *ngIf="!isStreaming" (click)="sendMessage()" [disabled]="isThinking || isImgUploading">Send</button>

    <!-- Stop button (only shown during streaming) -->
    <button *ngIf="isStreaming" (click)="stopStreaming()" class="stop-button">Stop</button>
  </div>
</div>
